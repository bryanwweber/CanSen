
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>cansen.utils &#8212; CanSen 1.2.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/katex-math.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/contrib/auto-render.min.js"></script>
    <script type="text/javascript" src="../../_static/katex_autorenderer.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for cansen.utils</h1><div class="highlight"><pre>
<span></span><span class="c1"># Standard libraries</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">pi</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="k">import</span> <span class="n">NamedTemporaryFile</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="k">import</span> <span class="n">ArgumentParser</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">cpu_count</span>

<span class="c1"># Third-party modules</span>
<span class="kn">from</span> <span class="nn">cantera</span> <span class="k">import</span> <span class="n">ck2cti</span>

<span class="c1"># Local imports</span>
<span class="kn">from</span> <span class="nn">.printer</span> <span class="k">import</span> <span class="n">divider</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="k">import</span> <span class="p">(</span><span class="n">KeywordError</span><span class="p">,</span>
                         <span class="n">MultipleProblemError</span><span class="p">,</span>
                         <span class="n">UnsupportedKeyword</span><span class="p">,</span>
                         <span class="n">UndefinedKeywordError</span><span class="p">,</span>
                         <span class="n">MissingReqdKeywordError</span><span class="p">,</span>
                         <span class="n">MissingKeyword</span><span class="p">,</span>
                         <span class="p">)</span>


<div class="viewcode-block" id="MyParser"><a class="viewcode-back" href="../../codedocs.html#cansen.utils.MyParser">[docs]</a><span class="k">class</span> <span class="nc">MyParser</span><span class="p">(</span><span class="n">ArgumentParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parser that redefines the error printing&quot;&quot;&quot;</span>

<div class="viewcode-block" id="MyParser.error"><a class="viewcode-back" href="../../codedocs.html#cansen.utils.MyParser.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">cansen: error: </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="convert_mech"><a class="viewcode-back" href="../../codedocs.html#cansen.utils.convert_mech">[docs]</a><span class="k">def</span> <span class="nf">convert_mech</span><span class="p">(</span><span class="n">mech_filename</span><span class="p">,</span> <span class="n">thermo_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a mechanism and return a string with the filename.</span>

<span class="sd">    Convert a CHEMKIN format mechanism to the Cantera CTI format using</span>
<span class="sd">    the Cantera built-in script `ck2cti`.</span>

<span class="sd">    :param mech_filename:</span>
<span class="sd">        Filename of the input CHEMKIN format mechanism. The converted</span>
<span class="sd">        CTI file will have the same name, but with `.cti` extension.</span>
<span class="sd">    :param thermo_filename:</span>
<span class="sd">        Filename of the thermodynamic database. Optional if the</span>
<span class="sd">        thermodynamic database is present in the mechanism input.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--input=&#39;</span><span class="o">+</span><span class="n">mech_filename</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">thermo_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--thermo=&#39;</span><span class="o">+</span><span class="n">thermo_filename</span><span class="p">)</span>

    <span class="c1"># Convert the mechanism</span>
    <span class="n">ck2cti</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">mech_filename</span> <span class="o">=</span> <span class="n">mech_filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.cti&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mechanism conversion successful, written to &#39;</span>
          <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mech_filename</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mech_filename</span></div>


<div class="viewcode-block" id="process_multi_input"><a class="viewcode-back" href="../../codedocs.html#cansen.utils.process_multi_input">[docs]</a><span class="k">def</span> <span class="nf">process_multi_input</span><span class="p">(</span><span class="n">input_filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Process a formatted input file into multiple cases.</span>

<span class="sd">    Processes a formatted input file that contains multiple cases into</span>
<span class="sd">    separate temporary files, for individual reading of keywords.</span>

<span class="sd">    :param input_filename:</span>
<span class="sd">        Filename of the SENKIN input file.</span>
<span class="sd">    :return filenames:</span>
<span class="sd">        List of temporary filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">temp_file</span> <span class="o">=</span> <span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_file</span><span class="p">:</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="c1"># skip comment or blank lines</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;END&#39;</span><span class="p">):</span>
                <span class="n">temp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                <span class="c1"># store temporary file and create new</span>
                <span class="n">temp_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                <span class="n">temp_file</span> <span class="o">=</span> <span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># just print line</span>
                <span class="n">temp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="c1"># check if last file actually written to; if not, close</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">temp_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">temp_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">filenames</span></div>


<div class="viewcode-block" id="remove_files"><a class="viewcode-back" href="../../codedocs.html#cansen.utils.remove_files">[docs]</a><span class="k">def</span> <span class="nf">remove_files</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delete files.</span>

<span class="sd">    :param files:</span>
<span class="sd">        List of names of files to be removed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="read_input_file"><a class="viewcode-back" href="../../codedocs.html#cansen.utils.read_input_file">[docs]</a><span class="k">def</span> <span class="nf">read_input_file</span><span class="p">(</span><span class="n">input_filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read a formatted input file and return a dictionary of keywords.</span>

<span class="sd">    :param input_filename:</span>
<span class="sd">        Filename of the SENKIN input file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize the dictionaries and lists that will be filled by</span>
    <span class="c1"># the parsing.</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">reactants</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">oxidizer</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">fuel</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">complete_products</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">additional_species</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># problem_type is a boolean indicating whether a problem selection</span>
    <span class="c1"># has been made.</span>
    <span class="n">problem_type</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># unsupported_keys is a list of keywords that are not supported</span>
    <span class="c1"># yet.</span>
    <span class="n">unsupported_keys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;ADAP&#39;</span><span class="p">,</span>   <span class="s1">&#39;AEXT&#39;</span><span class="p">,</span>   <span class="s1">&#39;AFRA&#39;</span><span class="p">,</span> <span class="s1">&#39;AGGA&#39;</span><span class="p">,</span>  <span class="s1">&#39;AGGB&#39;</span><span class="p">,</span>  <span class="s1">&#39;AGGD&#39;</span><span class="p">,</span>  <span class="s1">&#39;AGGE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;AGGFD&#39;</span><span class="p">,</span>  <span class="s1">&#39;AGGMN&#39;</span><span class="p">,</span>  <span class="s1">&#39;AINT&#39;</span><span class="p">,</span> <span class="s1">&#39;AREA&#39;</span><span class="p">,</span>  <span class="s1">&#39;AREAQ&#39;</span><span class="p">,</span> <span class="s1">&#39;AROP&#39;</span><span class="p">,</span>  <span class="s1">&#39;ASEN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ASTEPS&#39;</span><span class="p">,</span> <span class="s1">&#39;AVALUE&#39;</span><span class="p">,</span> <span class="s1">&#39;AVAR&#39;</span><span class="p">,</span> <span class="s1">&#39;BETA&#39;</span><span class="p">,</span>  <span class="s1">&#39;BLKEQ&#39;</span><span class="p">,</span> <span class="s1">&#39;BULK&#39;</span><span class="p">,</span>  <span class="s1">&#39;CLSC&#39;</span><span class="p">,</span>
        <span class="s1">&#39;CNTN&#39;</span><span class="p">,</span>   <span class="s1">&#39;CNTT&#39;</span><span class="p">,</span>   <span class="s1">&#39;COLR&#39;</span><span class="p">,</span> <span class="s1">&#39;DIST&#39;</span><span class="p">,</span>  <span class="s1">&#39;ENRG&#39;</span><span class="p">,</span>  <span class="s1">&#39;EPSG&#39;</span><span class="p">,</span>  <span class="s1">&#39;EPSR&#39;</span><span class="p">,</span> <span class="s1">&#39;CLSM&#39;</span><span class="p">,</span>
        <span class="s1">&#39;EPSS&#39;</span><span class="p">,</span>   <span class="s1">&#39;EPST&#39;</span><span class="p">,</span>   <span class="s1">&#39;ETCH&#39;</span><span class="p">,</span> <span class="s1">&#39;GFAC&#39;</span><span class="p">,</span>  <span class="s1">&#39;GMHTC&#39;</span><span class="p">,</span> <span class="s1">&#39;HTC&#39;</span><span class="p">,</span>   <span class="s1">&#39;HTRN&#39;</span><span class="p">,</span> <span class="s1">&#39;IPSR&#39;</span><span class="p">,</span>
        <span class="s1">&#39;IRET&#39;</span><span class="p">,</span>   <span class="s1">&#39;ISTP&#39;</span><span class="p">,</span>   <span class="s1">&#39;KLIM&#39;</span><span class="p">,</span> <span class="s1">&#39;MAXIT&#39;</span><span class="p">,</span> <span class="s1">&#39;MCUT&#39;</span><span class="p">,</span>  <span class="s1">&#39;MMASS&#39;</span><span class="p">,</span> <span class="s1">&#39;NADAP&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NEWRUN&#39;</span><span class="p">,</span> <span class="s1">&#39;NMOM&#39;</span><span class="p">,</span>   <span class="s1">&#39;NNEG&#39;</span><span class="p">,</span> <span class="s1">&#39;NOCG&#39;</span><span class="p">,</span>  <span class="s1">&#39;NSOL&#39;</span><span class="p">,</span>  <span class="s1">&#39;PNDE&#39;</span><span class="p">,</span>  <span class="s1">&#39;PPRO&#39;</span><span class="p">,</span> <span class="s1">&#39;PRNT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PROE&#39;</span><span class="p">,</span>   <span class="s1">&#39;PVFE&#39;</span><span class="p">,</span>   <span class="s1">&#39;QFUN&#39;</span><span class="p">,</span> <span class="s1">&#39;QLOS&#39;</span><span class="p">,</span>  <span class="s1">&#39;QPRO&#39;</span><span class="p">,</span>  <span class="s1">&#39;QRGEQ&#39;</span><span class="p">,</span> <span class="s1">&#39;QRSEQ&#39;</span><span class="p">,</span>
        <span class="s1">&#39;RELAXC&#39;</span><span class="p">,</span> <span class="s1">&#39;ROP&#39;</span><span class="p">,</span>    <span class="s1">&#39;RSTR&#39;</span><span class="p">,</span> <span class="s1">&#39;SCLM&#39;</span><span class="p">,</span>  <span class="s1">&#39;SCLS&#39;</span><span class="p">,</span>  <span class="s1">&#39;SCOR&#39;</span><span class="p">,</span>  <span class="s1">&#39;SENG&#39;</span><span class="p">,</span> <span class="s1">&#39;SENT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SFAC&#39;</span><span class="p">,</span>   <span class="s1">&#39;SIZE&#39;</span><span class="p">,</span>   <span class="s1">&#39;SOLUTION_TECHNIQUE&#39;</span><span class="p">,</span>     <span class="s1">&#39;SSTT&#39;</span><span class="p">,</span>  <span class="s1">&#39;SURF&#39;</span><span class="p">,</span> <span class="s1">&#39;TAMB&#39;</span><span class="p">,</span>
        <span class="s1">&#39;TGIV&#39;</span><span class="p">,</span>   <span class="s1">&#39;TIFP&#39;</span><span class="p">,</span>   <span class="s1">&#39;TRAN&#39;</span><span class="p">,</span> <span class="s1">&#39;TRES&#39;</span><span class="p">,</span>  <span class="s1">&#39;TRST&#39;</span><span class="p">,</span>  <span class="s1">&#39;TSRF&#39;</span><span class="p">,</span>  <span class="s1">&#39;TSTR&#39;</span><span class="p">,</span> <span class="s1">&#39;UIGN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;USET&#39;</span><span class="p">,</span>   <span class="s1">&#39;WENG&#39;</span><span class="p">,</span>   <span class="s1">&#39;XMLI&#39;</span>
        <span class="p">]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">divider</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Keyword Input:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="c1"># Echo the input back to the output file.</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;CONV&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">problem_type</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MultipleProblemError</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">problem_type</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;CONP&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">problem_type</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MultipleProblemError</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="n">problem_type</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;VPRO&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">problem_type</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
                    <span class="n">vproTime</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])]</span>
                    <span class="n">vproVol</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])]</span>
                    <span class="n">problem_type</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">problem_type</span> <span class="ow">and</span> <span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;problemType&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MultipleProblemError</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">problem_type</span> <span class="ow">and</span> <span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;problemType&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">vproTime</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">vproVol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;CONT&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">problem_type</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MultipleProblemError</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
                    <span class="n">problem_type</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;COTV&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">problem_type</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MultipleProblemError</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
                    <span class="n">problem_type</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;VTIM&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">problem_type</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MultipleProblemError</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
                    <span class="n">problem_type</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TTIM&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">problem_type</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MultipleProblemError</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span>
                    <span class="n">problem_type</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TPRO&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">problem_type</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
                    <span class="n">TproTime</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])]</span>
                    <span class="n">TproTemp</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])]</span>
                    <span class="n">problem_type</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">problem_type</span> <span class="ow">and</span> <span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;problemType&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MultipleProblemError</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">problem_type</span> <span class="ow">and</span> <span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;problemType&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">TproTime</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">TproTemp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ICEN&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">problem_type</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MultipleProblemError</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;problemType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
                    <span class="n">problem_type</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TEMP&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;REAC&#39;</span><span class="p">):</span>
                <span class="n">species</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">molefrac</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">reactants</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">species</span><span class="p">,</span> <span class="n">molefrac</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;PRES&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TIME&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;endTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TLIM&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;tempLimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;DTIGN&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;tempThresh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ATOL&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;abstol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;RTOL&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;reltol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;DELT&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;prntTimeInt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;DTSV&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;saveTimeInt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;STPT&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;maxTimeStep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;EQUI&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;eqRatio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;OXID&#39;</span><span class="p">):</span>
                <span class="n">species</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">molefrac</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">oxidizer</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="n">molefrac</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;FUEL&#39;</span><span class="p">):</span>
                <span class="n">species</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">molefrac</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">fuel</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="n">molefrac</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;CPROD&#39;</span><span class="p">):</span>
                <span class="n">species</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">complete_products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ADD&#39;</span><span class="p">):</span>
                <span class="n">species</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">molefrac</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">additional_species</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="n">molefrac</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;SENS&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;sensitivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;VOL &#39;</span><span class="p">):</span>
                <span class="c1"># The default units of volume in SENKIN are cm**3, but</span>
                <span class="c1"># the default in Cantera is m**3 so we have to convert.</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;reactorVolume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0E6</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;RTLS&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;sensRelTol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ATLS&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;sensAbsTol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;IGNBREAK&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;break_on_ignition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;CMPR&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;comp_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;DEG0&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;start_crank_angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;VOLD&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;swept_volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0E6</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;VOLC&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;clear_volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0E6</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;LOLR&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;rod_radius_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;RPM&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;rev_per_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;BORE&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;cyl_bore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0E2</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;STROKE&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;stroke_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0E2</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;RODL&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;connect_rod_len&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0E2</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;CRAD&#39;</span><span class="p">):</span>
                <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;crank_radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0E2</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="n">unsupported_keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UnsupportedKeyword</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;END&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UndefinedKeywordError</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">divider</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># The endTime, temperature, pressure, and problemType are required</span>
    <span class="c1"># input. Exit if any of them are not found.</span>
    <span class="k">if</span> <span class="s1">&#39;endTime&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MissingReqdKeywordError</span><span class="p">(</span><span class="s1">&#39;TIME&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;temperature&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MissingReqdKeywordError</span><span class="p">(</span><span class="s1">&#39;TEMP&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;pressure&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MissingReqdKeywordError</span><span class="p">(</span><span class="s1">&#39;PRES&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;problemType&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MissingReqdKeywordError</span><span class="p">(</span>
            <span class="s1">&#39;CONP&#39;</span><span class="p">,</span> <span class="s1">&#39;CONV&#39;</span><span class="p">,</span> <span class="s1">&#39;VPRO&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CONT&#39;</span><span class="p">,</span> <span class="s1">&#39;ICEN&#39;</span><span class="p">,</span> <span class="s1">&#39;TPRO&#39;</span><span class="p">,</span>
            <span class="s1">&#39;COTV&#39;</span><span class="p">,</span> <span class="s1">&#39;TTIM&#39;</span><span class="p">,</span> <span class="s1">&#39;VTIM&#39;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;problemType&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;vproTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vproTime</span>
        <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;vproVol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vproVol</span>
    <span class="k">elif</span> <span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;problemType&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;TproTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TproTime</span>
        <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;TproTemp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TproTemp</span>
    <span class="k">elif</span> <span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;problemType&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
        <span class="c1"># Variables needed to calculate piston velocity and other</span>
        <span class="c1"># quantities for the IC Engine model: Stroke length, rod</span>
        <span class="c1"># length to crank radius ratio, rpm, starting angle, initial</span>
        <span class="c1"># volume</span>

        <span class="k">if</span> <span class="s1">&#39;rev_per_min&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingReqdKeywordError</span><span class="p">(</span><span class="s1">&#39;RPM&#39;</span><span class="p">)</span>

        <span class="c1"># Handle the various ways to calculate the stroke length</span>
        <span class="k">if</span> <span class="s1">&#39;stroke_length&#39;</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info: &#39;STROKE&#39; was specified, and will be used for the &quot;</span>
                  <span class="s2">&quot;stroke length regardless of other parameters.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keywords</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;swept_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;cyl_bore&#39;</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info: Using swept volume and cylinder bore to &quot;</span>
                  <span class="s2">&quot;calculate stroke length.&quot;</span><span class="p">)</span>
            <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;stroke_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;swept_volume&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span> <span class="o">/</span>
                                         <span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;cyl_bore&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keywords</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;comp_ratio&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;clear_volume&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;cyl_bore&#39;</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info: Using compression ratio, clearance volume, and &quot;</span>
                  <span class="s2">&quot;cylinder bore to calculate stroke length.&quot;</span><span class="p">)</span>
            <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;swept_volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;clear_volume&#39;</span><span class="p">]</span> <span class="o">*</span>
                                        <span class="p">(</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;comp_ratio&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;stroke_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;swept_volume&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span> <span class="o">/</span>
                                         <span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;cyl_bore&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">elif</span> <span class="s1">&#39;crank_radius&#39;</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info: Using crank radius to compute the stroke length.&quot;</span><span class="p">)</span>
            <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;stroke_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;crank_radius&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingReqdKeywordError</span><span class="p">(</span>
                <span class="s1">&#39;STROKE&#39;</span><span class="p">,</span> <span class="s1">&#39;VOLD&#39;</span><span class="p">,</span> <span class="s1">&#39;BORE&#39;</span><span class="p">,</span>
                <span class="s1">&#39;CMPR&#39;</span><span class="p">,</span> <span class="s1">&#39;VOLC&#39;</span><span class="p">,</span> <span class="s1">&#39;CRAD&#39;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Handle the various ways to calculate the initial volume</span>
        <span class="k">if</span> <span class="s1">&#39;reactorVolume&#39;</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info: The inital reactor volume was specified by the VOL &quot;</span>
                  <span class="s2">&quot;keyword and this value will be used regardless of other &quot;</span>
                  <span class="s2">&quot;settings.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keywords</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;swept_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;clear_volume&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;comp_ratio&#39;</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">KeywordError</span><span class="p">(</span><span class="s2">&quot;Only two of &#39;VOLD&#39;, &#39;VOLC&#39;, and &#39;CMPR&#39; may be &quot;</span>
                               <span class="s2">&quot;specified.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keywords</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;swept_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;clear_volume&#39;</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info: Computing initial reactor volume from the swept &quot;</span>
                  <span class="s2">&quot;volume and the clearance volume.&quot;</span><span class="p">)</span>
            <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;reactorVolume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;swept_volume&#39;</span><span class="p">]</span> <span class="o">+</span>
                                         <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;clear_volume&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keywords</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;comp_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;clear_volume&#39;</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info: Computing initial reactor volume from the &quot;</span>
                  <span class="s2">&quot;compression ratio and clearance volume.&quot;</span><span class="p">)</span>
            <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;reactorVolume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;comp_ratio&#39;</span><span class="p">]</span> <span class="o">*</span>
                                         <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;clear_volume&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keywords</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;comp_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;swept_volume&#39;</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info: Computing initial reactor volume from the &quot;</span>
                  <span class="s2">&quot;compression ratio and swept volume.&quot;</span><span class="p">)</span>
            <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;reactorVolume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;swept_volume&#39;</span><span class="p">]</span> <span class="o">*</span>
                                         <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;comp_ratio&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keywords</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;clear_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;cyl_bore&#39;</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info: Computing initial reactor volume from the cylinder &quot;</span>
                  <span class="s2">&quot;bore, stroke length, and clearance volume.&quot;</span><span class="p">)</span>
            <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;reactorVolume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;cyl_bore&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span>
                                         <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;stroke_length&#39;</span><span class="p">]</span> <span class="o">+</span>
                                         <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;clear_volume&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingReqdKeywordError</span><span class="p">(</span><span class="s1">&#39;VOLD&#39;</span><span class="p">,</span> <span class="s1">&#39;VOLC&#39;</span><span class="p">,</span> <span class="s1">&#39;CMPR&#39;</span><span class="p">,</span> <span class="s1">&#39;BORE&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;VOL&#39;</span><span class="p">)</span>

        <span class="c1"># Handle the ways to calculate the rod length to radius ratio</span>
        <span class="k">if</span> <span class="s1">&#39;rod_radius_ratio&#39;</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info: The connecting rod length to crank radius ratio was &quot;</span>
                  <span class="s2">&quot;specified by the &#39;LOLR&#39; keyword and this value will be &quot;</span>
                  <span class="s2">&quot;used regardless of other settings.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">keywords</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;connect_rod_len&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;crank_radius&#39;</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info: Using given connecting rod length and crank radius &quot;</span>
                  <span class="s2">&quot;to compute the ratio.&quot;</span><span class="p">)</span>
            <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;rod_radius_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;connect_rod_len&#39;</span><span class="p">]</span> <span class="o">/</span>
                                            <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;crank_radius&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingReqdKeywordError</span><span class="p">(</span><span class="s1">&#39;LOLR&#39;</span><span class="p">,</span> <span class="s1">&#39;CRAD&#39;</span><span class="p">,</span> <span class="s1">&#39;RODL&#39;</span><span class="p">)</span>

    <span class="c1"># Set the default reactor volume, if it is not specified</span>
    <span class="k">if</span> <span class="s1">&#39;reactorVolume&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
        <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;reactorVolume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0E-6</span>
        <span class="k">raise</span> <span class="n">MissingKeyword</span><span class="p">(</span><span class="s1">&#39;No reactor volume specified, assuming &#39;</span>
                             <span class="s1">&#39;1.0 cm**3.&#39;</span><span class="p">)</span>

    <span class="c1"># The reactants can be specified by REAC or EQUI + FUEL + OXID +</span>
    <span class="c1"># CPROD. One or the other of these must be present; if neither or</span>
    <span class="c1"># both are present, exit.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">reactants</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">oxidizer</span> <span class="ow">or</span> <span class="n">fuel</span> <span class="ow">or</span> <span class="n">complete_products</span> <span class="ow">or</span> <span class="n">additional_species</span> <span class="ow">or</span>
             <span class="p">(</span><span class="s1">&#39;eqRatio&#39;</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="n">KeywordError</span><span class="p">(</span><span class="s1">&#39;REAC and EQUI cannot both be specified.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;eqRatio&#39;</span> <span class="ow">in</span> <span class="n">keywords</span> <span class="ow">and</span> <span class="ow">not</span>
            <span class="p">(</span><span class="n">oxidizer</span> <span class="ow">and</span> <span class="n">fuel</span> <span class="ow">and</span> <span class="n">complete_products</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">KeywordError</span><span class="p">(</span><span class="s1">&#39;If EQUI is specified, all of FUEL, OXID and &#39;</span>
                           <span class="s1">&#39;CPROD must be as well.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">reactants</span><span class="p">:</span>
        <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;reactants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reactants</span>
    <span class="k">elif</span> <span class="s1">&#39;eqRatio&#39;</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
        <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;oxidizer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oxidizer</span>
        <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;fuel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fuel</span>
        <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;completeProducts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">complete_products</span>
        <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;additionalSpecies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">additional_species</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MissingReqdKeywordError</span><span class="p">(</span><span class="s1">&#39;REAC&#39;</span><span class="p">,</span> <span class="s1">&#39;EQUI&#39;</span><span class="p">)</span>

    <span class="c1"># Set the default temperature threshold to determine ignition</span>
    <span class="c1"># delay.</span>
    <span class="k">if</span> <span class="s1">&#39;tempThresh&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
        <span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;tempThresh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span>

    <span class="k">return</span> <span class="n">keywords</span></div>


<div class="viewcode-block" id="cli_parser"><a class="viewcode-back" href="../../codedocs.html#cansen.utils.cli_parser">[docs]</a><span class="k">def</span> <span class="nf">cli_parser</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse command line interface input.</span>

<span class="sd">    :param argv:</span>
<span class="sd">        List of command line options.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">MyParser</span><span class="p">(</span>
        <span class="n">prog</span><span class="o">=</span><span class="s1">&#39;cansen&#39;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;CanSen - the SENKIN-like wrapper for Cantera written in Python.&#39;</span>
    <span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-V&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Show the version of CanSen and quit&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="s1">&#39;--input&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The simulation input file in SENKIN format.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;--output&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;output.out&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The text output file.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-x&#39;</span><span class="p">,</span> <span class="s1">&#39;--save&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;save.hdf&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The binary save output file.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--chem&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;chem.xml&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The chemistry input file, in either CHEMKIN,&#39;</span>
                             <span class="s1">&#39; Cantera CTI or CTML format.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;--thermo&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The thermodynamic database. Optional if the&#39;</span>
                             <span class="s1">&#39; thermodynamic database is specified in the&#39;</span>
                             <span class="s1">&#39; chemistry input file. Otherwise, required.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--convert&#39;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Convert the input mechanism to CTI format &#39;</span>
                             <span class="s1">&#39;and quit. If ``--convert`` is specified, &#39;</span>
                             <span class="s1">&#39;the SENKIN input file is optional.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;--multi&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                        <span class="n">const</span><span class="o">=</span><span class="n">cpu_count</span><span class="p">(),</span>
                        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Run multiple cases from the input file. &#39;</span>
                             <span class="s1">&#39;Optional. If ``-m`` is used, must specify &#39;</span>
                             <span class="s1">&#39;number of processors to be used (e.g., &#39;</span>
                             <span class="s1">&#39;``-m 4``). If ``--multi`` is specified, &#39;</span>
                             <span class="s1">&#39;CanSen uses the available number of &#39;</span>
                             <span class="s1">&#39;processors by default.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>

    <span class="n">filenames</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">._version</span> <span class="k">import</span> <span class="n">__version__</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CanSen </span><span class="si">{version}</span><span class="s1"> from </span><span class="si">{path}</span><span class="s1"> ()&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">input</span><span class="p">:</span>
        <span class="n">input_filename</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">input</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">input_filename</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: The specified input file &#39;</span>
                  <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_filename</span><span class="p">)</span>
                  <span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">filenames</span><span class="p">[</span><span class="s1">&#39;input_filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_filename</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">input</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">convert</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: The input file must be specified&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filenames</span><span class="p">[</span><span class="s1">&#39;input_filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">filenames</span><span class="p">[</span><span class="s1">&#39;output_filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">output</span>
    <span class="n">filenames</span><span class="p">[</span><span class="s1">&#39;save_filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">save</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">chem</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: The specified chemistry file &#39;</span>
              <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">chem</span><span class="p">)</span>
              <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">filenames</span><span class="p">[</span><span class="s1">&#39;mech_filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">chem</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">thermo</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">thermo</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: The specified thermodynamic database &#39;</span>
                  <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">thermo</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">filenames</span><span class="p">[</span><span class="s1">&#39;thermo_filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">thermo</span>

    <span class="n">convert</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">convert</span>

    <span class="n">num_proc</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">multi</span><span class="p">:</span>
        <span class="n">multi</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">num_proc</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">multi</span>

    <span class="k">return</span> <span class="n">filenames</span><span class="p">,</span> <span class="n">convert</span><span class="p">,</span> <span class="n">multi</span><span class="p">,</span> <span class="n">num_proc</span></div>


<div class="viewcode-block" id="reactor_interpolate"><a class="viewcode-back" href="../../codedocs.html#cansen.utils.reactor_interpolate">[docs]</a><span class="k">def</span> <span class="nf">reactor_interpolate</span><span class="p">(</span><span class="n">interp_time</span><span class="p">,</span> <span class="n">state1</span><span class="p">,</span> <span class="n">state2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Linearly interpolate the reactor states to the given input time.</span>

<span class="sd">    :param interp_time:</span>
<span class="sd">        Time at which the interpolated values should be calculated</span>
<span class="sd">    :param state1:</span>
<span class="sd">        Array of the state information at the previous time step.</span>
<span class="sd">    :param state2:</span>
<span class="sd">        Array of the state information at the current time step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">interp_state</span> <span class="o">=</span> <span class="n">state1</span> <span class="o">+</span> <span class="p">((</span><span class="n">state2</span> <span class="o">-</span> <span class="n">state1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">interp_time</span> <span class="o">-</span> <span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span>
                             <span class="p">(</span><span class="n">state2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">state1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">interp_state</span></div>


<div class="viewcode-block" id="equivalence_ratio"><a class="viewcode-back" href="../../codedocs.html#cansen.utils.equivalence_ratio">[docs]</a><span class="k">def</span> <span class="nf">equivalence_ratio</span><span class="p">(</span><span class="n">gas</span><span class="p">,</span> <span class="n">eq_ratio</span><span class="p">,</span> <span class="n">fuel</span><span class="p">,</span> <span class="n">oxidizer</span><span class="p">,</span> <span class="n">complete_products</span><span class="p">,</span>
                      <span class="n">additional_species</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the mixture mole fractions from the equivalence ratio.</span>

<span class="sd">    Given the equivalence ratio, fuel mixture, oxidizer mixture,</span>
<span class="sd">    the products of complete combustion, and any additional species for</span>
<span class="sd">    the mixture, return a string containing the mole fractions of the</span>
<span class="sd">    species, suitable for setting the state of the input :py:class:`~cantera.ThermoPhase`.</span>

<span class="sd">    :param gas:</span>
<span class="sd">        Cantera :py:class:`~cantera.ThermoPhase` object containing the desired species.</span>
<span class="sd">    :param eq_ratio:</span>
<span class="sd">        Equivalence ratio</span>
<span class="sd">    :param fuel:</span>
<span class="sd">        Dictionary of molecules in the fuel mixture and the fraction of</span>
<span class="sd">        each molecule in the fuel mixture</span>
<span class="sd">    :param oxidizer:</span>
<span class="sd">        Dictionary of molecules in the oxidizer mixture and the</span>
<span class="sd">        fraction of each molecule in the oxidizer mixture.</span>
<span class="sd">    :param complete_products:</span>
<span class="sd">        List of species in the products of complete combustion.</span>
<span class="sd">    :param additional_species:</span>
<span class="sd">        Dictionary of molecules that will be added to the mixture.</span>
<span class="sd">        The mole fractions given in this dictionary are as a fraction</span>
<span class="sd">        of the total mixture.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reactants</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">cprod_elems</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">fuel_elems</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">oxid_elems</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Check sum of fuel and oxidizer values; normalize if greater than 1</span>
    <span class="n">fuel_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fuel</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">fuel_sum</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fuel</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fuel</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">fuel_sum</span>

    <span class="n">oxid_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">oxidizer</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">oxid_sum</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">oxidizer</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">oxidizer</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">oxid_sum</span>

    <span class="c1"># Check oxidation state of complete products</span>
    <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">complete_products</span><span class="p">,</span> <span class="n">gas</span><span class="o">.</span><span class="n">element_names</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cprod_elems</span><span class="p">:</span>
            <span class="n">cprod_elems</span><span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">cprod_elems</span><span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">upper</span><span class="p">()][</span><span class="n">sp</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gas</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">el</span><span class="p">))</span>

    <span class="n">num_C_cprod</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cprod_elems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">num_H_cprod</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cprod_elems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">num_O_cprod</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cprod_elems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="n">oxid_state</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">num_C_cprod</span> <span class="o">+</span> <span class="n">num_H_cprod</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">num_O_cprod</span>
    <span class="k">if</span> <span class="n">oxid_state</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: One or more products of incomplete combustion &quot;</span>
              <span class="s2">&quot;were specified.&quot;</span><span class="p">)</span>

    <span class="c1"># Find the number of H, C, and O atoms in the fuel molecules.</span>
    <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">fuel</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">gas</span><span class="o">.</span><span class="n">element_names</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">el</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fuel_elems</span><span class="p">:</span>
            <span class="n">fuel_elems</span><span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">fuel_elems</span><span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">+=</span> <span class="n">gas</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">el</span><span class="p">)</span> <span class="o">*</span> <span class="n">fuel</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span>

    <span class="n">num_C_fuel</span> <span class="o">=</span> <span class="n">fuel_elems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">num_H_fuel</span> <span class="o">=</span> <span class="n">fuel_elems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">num_O_fuel</span> <span class="o">=</span> <span class="n">fuel_elems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Find the number of H, C, and O atoms in the oxidizer molecules.</span>
    <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">oxidizer</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">gas</span><span class="o">.</span><span class="n">element_names</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">el</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">oxid_elems</span><span class="p">:</span>
            <span class="n">oxid_elems</span><span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">oxid_elems</span><span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">+=</span> <span class="n">gas</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">el</span><span class="p">)</span> <span class="o">*</span> <span class="n">oxidizer</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span>

    <span class="n">num_O_oxid</span> <span class="o">=</span> <span class="n">oxid_elems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Check that all of the elements specified in the fuel and oxidizer</span>
    <span class="c1"># are present in the complete products and vice versa.</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">cprod_elems</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">sum</span><span class="p">(</span><span class="n">cprod_elems</span><span class="p">[</span><span class="n">el</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">fuel_elems</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span>
             <span class="n">oxid_elems</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cprod_elems</span><span class="p">[</span><span class="n">el</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">fuel_elems</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">oxid_elems</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: Must specify all elements in the fuel + oxidizer &#39;</span>
                  <span class="s1">&#39;in the complete products and vice-versa&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Compute the amount of oxidizer required to consume all the</span>
    <span class="c1"># carbon and hydrogen in the complete products</span>
    <span class="k">if</span> <span class="n">num_C_cprod</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">cprod_elems</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">ox</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">cprod_elems</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">][</span><span class="n">sp</span><span class="p">]</span>
                  <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">spec</span> <span class="k">if</span> <span class="n">cprod_elems</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">][</span><span class="n">sp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">C_multiplier</span> <span class="o">=</span> <span class="n">ox</span><span class="o">/</span><span class="n">num_C_cprod</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">C_multiplier</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">num_H_cprod</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">cprod_elems</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">ox</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">cprod_elems</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">][</span><span class="n">sp</span><span class="p">]</span>
                  <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">spec</span> <span class="k">if</span> <span class="n">cprod_elems</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="n">sp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">H_multiplier</span> <span class="o">=</span> <span class="n">ox</span><span class="o">/</span><span class="n">num_H_cprod</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">H_multiplier</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Compute how many O atoms are required to oxidize everybody</span>
    <span class="n">num_O_req</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_C_fuel</span> <span class="o">*</span> <span class="n">C_multiplier</span> <span class="o">+</span>
                 <span class="n">num_H_fuel</span> <span class="o">*</span> <span class="n">H_multiplier</span> <span class="o">-</span> <span class="n">num_O_fuel</span><span class="p">)</span>
    <span class="n">O_mult</span> <span class="o">=</span> <span class="n">num_O_req</span><span class="o">/</span><span class="n">num_O_oxid</span>

    <span class="c1"># Find the total number of moles in the fuel + oxidizer mixture</span>
    <span class="n">total_oxid_moles</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">O_mult</span> <span class="o">*</span> <span class="n">amt</span> <span class="k">for</span> <span class="n">amt</span> <span class="ow">in</span> <span class="n">oxidizer</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
    <span class="n">total_fuel_moles</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">eq_ratio</span> <span class="o">*</span> <span class="n">amt</span> <span class="k">for</span> <span class="n">amt</span> <span class="ow">in</span> <span class="n">fuel</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
    <span class="n">total_reactant_moles</span> <span class="o">=</span> <span class="n">total_oxid_moles</span> <span class="o">+</span> <span class="n">total_fuel_moles</span>

    <span class="c1"># Handle the case where additional species are specified separately</span>
    <span class="k">if</span> <span class="n">additional_species</span><span class="p">:</span>
        <span class="n">total_additional_species</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">additional_species</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">total_additional_species</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: Additional species must sum to less than 1&#39;</span><span class="p">)</span>
        <span class="n">remain</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">total_additional_species</span>
        <span class="k">for</span> <span class="n">species</span><span class="p">,</span> <span class="n">molefrac</span> <span class="ow">in</span> <span class="n">additional_species</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">add_spec</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">species</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">molefrac</span><span class="p">)])</span>
            <span class="n">reactants</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">reactants</span><span class="p">,</span> <span class="n">add_spec</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">remain</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Compute the mole fractions of the fuel and oxidizer components</span>
    <span class="c1"># given that a certain portion of the mixture will have been taken</span>
    <span class="c1"># up by the additional species, if any.</span>
    <span class="k">for</span> <span class="n">species</span><span class="p">,</span> <span class="n">ox_amt</span> <span class="ow">in</span> <span class="n">oxidizer</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">molefrac</span> <span class="o">=</span> <span class="n">ox_amt</span> <span class="o">*</span> <span class="n">O_mult</span><span class="o">/</span><span class="n">total_reactant_moles</span> <span class="o">*</span> <span class="n">remain</span>
        <span class="n">add_spec</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">species</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">molefrac</span><span class="p">)])</span>
        <span class="n">reactants</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">reactants</span><span class="p">,</span> <span class="n">add_spec</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">species</span><span class="p">,</span> <span class="n">fuel_amt</span> <span class="ow">in</span> <span class="n">fuel</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">molefrac</span> <span class="o">=</span> <span class="n">fuel_amt</span><span class="o">*</span><span class="n">eq_ratio</span><span class="o">/</span><span class="n">total_reactant_moles</span><span class="o">*</span><span class="n">remain</span>
        <span class="n">add_spec</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">species</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">molefrac</span><span class="p">)])</span>
        <span class="n">reactants</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">reactants</span><span class="p">,</span> <span class="n">add_spec</span><span class="p">])</span>

    <span class="c1"># Take off the first character, which is a comma</span>
    <span class="n">reactants</span> <span class="o">=</span> <span class="n">reactants</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">reactants</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">CanSen</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=bryanwweber&repo=CanSen&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">CanSen Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../keywords.html">Supported Input Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../icengine.html">Internal Combustion Engine Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../postprocessing.html">Postprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../codedocs.html">Code Documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Bryan W. Weber.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    
    <a href="https://github.com/bryanwweber/CanSen" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>